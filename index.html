<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Friendship Details Multi-Step Form</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f8;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background: white;
      max-width: 600px;
      width: 90%;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #222;
      margin-bottom: 30px;
    }
    .progressbar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      list-style: none;
      counter-reset: step;
      padding: 0;
    }
    .progressbar li {
      counter-increment: step;
      position: relative;
      width: 20%;
      text-align: center;
      font-weight: 600;
      color: #a0aec0;
      font-size: 13px;
      cursor: default;
    }
    .progressbar li:before {
      content: counter(step);
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 30px;
      line-height: 30px;
      background: #e2e8f0;
      border-radius: 50%;
      color: #7b8ca1;
      border: 2px solid #cbd5e0;
      font-weight: 700;
    }
    .progressbar li.active {
      color: #4c51bf;
    }
    .progressbar li.active:before {
      background: #4c51bf;
      color: white;
      border-color: #4c51bf;
      box-shadow: 0 0 8px rgba(76,81,191,0.4);
    }
    .progressbar li:not(:last-child):after {
      content: '';
      position: absolute;
      top: -15px;
      left: calc(50% + 15px);
      width: calc(100% - 30px);
      height: 3px;
      background: #e2e8f0;
      z-index: -1;
      transition: background-color 0.3s ease;
    }
    .progressbar li.active:not(:last-child):after {
      background: #4c51bf;
    }
    form {
      position: relative;
    }
    .step {
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }
    .step.active {
      display: block;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #2d3748;
    }
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 10px 14px;
      border-radius: 7px;
      border: 1.8px solid #cbd5e0;
      font-size: 14px;
      color: #2d3748;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      resize: vertical;
    }
    input:focus,
    select:focus,
    textarea:focus {
      border-color: #4c51bf;
      outline: none;
      box-shadow: 0 0 6px #b3c7ff;
    }
    textarea {
      min-height: 80px;
    }
    .buttons {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
    }
    button {
      padding: 12px 26px;
      border: none;
      cursor: pointer;
      border-radius: 7px;
      background-color: #4c51bf;
      color: white;
      font-size: 15px;
      font-weight: 600;
      min-width: 110px;
      transition: background-color 0.25s ease;
    }
    button:disabled {
      cursor: not-allowed;
      background-color: #a0aec0;
    }
    button:hover:not(:disabled) {
      background-color: #3c3f9d;
    }
    #photoDragArea {
      border: 2px dashed #4c51bf;
      border-radius: 10px;
      padding: 25px;
      text-align: center;
      color: #4c51bf;
      user-select: none;
      cursor: pointer;
      margin-top: 8px;
      position: relative;
    }
    #photoDragArea.dragover {
      background-color: #e9e9ff;
    }
    #photoPreview {
      margin-top: 16px;
      max-width: 180px;
      border-radius: 10px;
      border: 1px solid #cbd5e0;
      box-shadow: 0 4px 8px rgba(76,81,191,0.15);
      display: none;
    }
    .char-counter {
      font-size: 12px;
      color: #718096;
      text-align: right;
      margin-top: 3px;
      user-select: none;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="container" role="main" aria-labelledby="formTitle">
    <h2 id="formTitle">Friendship Details Form</h2>

    <ul class="progressbar" aria-label="Form progress">
      <li class="active">Personal Info</li>
      <li>Relationship</li>
      <li>Meeting & Education</li>
      <li>Best Friends</li>
      <li>Summary</li>
    </ul>

    <form id="friendForm" enctype="multipart/form-data" novalidate>

      <!-- Step 1 -->
      <section class="step active" aria-label="Personal Information section">
        <label for="name">Full Name *</label>
        <input id="name" name="name" type="text" placeholder="Enter your full name"  required/>

        <label for="nickname">Nickname</label>
        <input id="nickname" name="nickname" type="text" placeholder="Enter your nickname" />

        <label for="age">Age  *</label>
        <input id="age" name="age" type="number" min="1" max="120"  placeholder="Enter your age"   required />

        <label for="dob">Date of Birth</label>
        <input id="dob" name="dob" type="date"  required/>

        <label for="mobile">Mobile Number *</label>
        <input id="mobile" name="mobile" type="tel" pattern="\\d{10}" required placeholder="Enter your phone no" required/>

        <label for="gender">Gender</label>
        <select id="gender" name="gender" required>
          <option value="">Select</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
          <option value="na">Prefer not to say</option>
        </select>

        <label for="email">Email Address *</label>
        <input id="email" name="email" type="email" placeholder="Enter your email address"  required />

        <label for="favcolor">Favorite Color</label>
        <input id="favcolor" name="favcolor" type="text" placeholder="Enter favorite color" />

        <label for="favfood">Favorite Food</label>
        <input id="favfood" name="favfood" type="text" placeholder="Enter your favorite food" />

        <label for="hobbies">Hobbies and Interests</label>
        <textarea id="hobbies" name="hobbies" maxlength="500" placeholder="Enter your hobbies and interests" aria-describedby="hobbiesCounter"></textarea>
        <div id="hobbiesCounter" class="char-counter">0 / 500</div>
      </section>

      <!-- Step 2 -->
      <section class="step" aria-label="Relationship section">
        <label for="excrush">Ex-Crush Name</label>
        <input id="excrush" name="excrush" type="text" placeholder="Enter your previous crush name" required/>

        <label for="crush">Crush Name</label>
        <input id="crush" name="crush" type="text" placeholder="Enter your present crush name" />

        <label for="address">Address</label>
        <textarea id="address" name="address" rows="2" maxlength="300" aria-describedby="addressCounter"placeholder="Enter your address" required></textarea>
        <div id="addressCounter" class="char-counter">0 / 300</div>

        <label for="specialtask">Would you recommend this friend for specific tasks?</label>
        <select id="specialtask" name="specialtask">
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>

        <label>Friendship Closeness Rating </label>
        <div class="emoji-rating" role="radiogroup" aria-label="Friendship rating">
          <span role="radio" tabindex="0" aria-checked="false" data-value="1">&#128577;</span>
          <span role="radio" tabindex="-1" aria-checked="false" data-value="2">&#128528;</span>
          <span role="radio" tabindex="-1" aria-checked="false" data-value="3">&#128522;</span>
          <span role="radio" tabindex="-1" aria-checked="false" data-value="4">&#128515;</span>
          <span role="radio" tabindex="-1" aria-checked="false" data-value="5">&#128525;</span>
        </div>
        <input type="hidden" id="friendshiprating" name="friendshiprating" />

        <label for="secretsshared">Do you share personal secrets?</label>
        <select id="secretsshared" name="secretsshared">
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </section>

      <!-- Step 3 -->
      <section class="step" aria-label="First Meeting and Education section">
        <label for="firstmeet">How Did You First Meet? *</label>
        <select id="firstmeet" name="firstmeet" required aria-required="true" onchange="toggleMeetingOptions()">
          <option value="">Select</option>
          <option value="school">School</option>
          <option value="graduation">Graduation</option>
          <option value="other">Other</option>
        </select>

        <div id="schoolClassDiv" class="hidden">
          <label for="schoolclass">School Class</label>
          <select id="schoolclass" name="schoolclass">
            <option value="">Select</option>
            <option value="nursery">Nursery</option>
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
            <option value="11">Class 11</option>
            <option value="12">Class 12</option>
          </select>
        </div>

        <div id="gradDiv" class="hidden">
          <label for="gradtype">Graduation</label>
          <select id="gradtype" name="gradtype">
            <option value="">Select</option>
            <option value="ba">B.A</option>
            <option value="bba">BBA</option>
            <option value="bca">BCA</option>
            <option value="b.com">B.Com</option>
            <option value="b.sc">B.Sc</option>
            <option value="b.tech">B-TECH</option>
            <option value="iert">IERT</option>
            <option value="polytecnic">POLYTECNIC</option>
            <option value="mba">MBA</option>
            <option value="other">OTHER</option>
          </select>
        </div>
       <div class="field hidden" id="otherdiv">
        <label for="othertype"> Other*</label>
        <select id="othertype" name="othertype">
          <option value="select">Select</option>
          <option value="online">Online</option>
          <option value="relations">In Relation</option>
          <option value="un">Unnecessary</option>
        </select>
      </div>

        <label for="meetstory">Narrative of Your First Meeting</label>
        <textarea id="meetstory" name="meetstory" rows="3" maxlength="800" placeholder="Describe your first meeting" aria-describedby="meetstoryCounter"></textarea>
        <div id="meetstoryCounter" class="char-counter">0 / 800</div>

        <label for="currentedu">Current Level of Education *</label>
        <select id="currentedu" name="currentedu" required aria-required="true" onchange="togglePreparationOptions()">
          <option value="">Select</option>
           <option value="ba">B.A</option>
            <option value="bba">BBA</option>
            <option value="bca">BCA</option>
            <option value="b.com">B.Com</option>
            <option value="b.sc">B.Sc</option>
            <option value="b.tech">B-Tech</option>
            <option value="iert">IERT</option>
            <option value="polytecnic">POLYTECNIC</option>
            <option value="mba">MBA</option>
          <option value="personal_business">Personal Business</option>
          <option value="preparation">Preparation</option>
          <option value="other">OTHER</option>
        </select>

        <div id="prepDiv" class="hidden">
          <label for="preptype">Exam Preparation For</label>
          <select id="preptype" name="preptype">
            <option value="">Select</option>
            <option value="jee">JEE Mains</option>
            <option value="neet">NEET</option>
            <option value="neet">CUET</option>
            <option value="neet">GATE</option>
            <option value="civilservices">Civil Services</option>
          </select>
        </div>
      </section>

      <!-- Step 4 -->
      <section class="step" aria-label="Best Friends section">
        <label>Best Friend Names (minimum 3 required) *</label>
        <input type="text" name="bestfriend1" placeholder="Best Friend Name 1" required />
        <input type="text" name="bestfriend2" placeholder="Best Friend Name 2" required />
        <input type="text" name="bestfriend3" placeholder="Best Friend Name 3" required />
        <input type="text" name="bestfriend4" placeholder="Best Friend Name 4" class="hidden" />
        <input type="text" name="bestfriend5" placeholder="Best Friend Name 5" class="hidden" />
        <input type="text" name="bestfriend6" placeholder="Best Friend Name 6" class="hidden" />
        <input type="text" name="bestfriend7" placeholder="Best Friend Name 7" class="hidden" />
        <button type="button" id="addFriendBtn">Add More</button>

        <label for="photo">Upload Your Photo *</label>
        <div id="photoDragArea" tabindex="0" aria-label="Drag and drop photo upload or click to select photo">
          Drag & Drop or Click to Upload Photo
          <input type="file" id="photo" name="photo" accept="image/*" required class="hidden" />
          <img id="photoPreview" alt="Photo Preview" />
        </div>
      </section>

      <!-- Step 5 -->
      <section class="step" aria-label="Summary section">
        <h3>Review Your Information Before Submission</h3>
        <pre id="summaryContent" style="white-space: pre-wrap; padding: 15px; border: 1px solid #cbd5e0; border-radius: 10px; height: 220px; overflow-y: auto;"></pre>

        <label id="captchaLabel" for="captchaInput"></label>
        <input id="captchaInput" name="captcha" type="text" required placeholder="Answer" />
      </section>

      <div class="buttons">
        <button type="button" id="prevBtn" disabled>Previous</button>
        <button type="button" id="nextBtn">Next</button>
      </div>
    </form>
  </div>

  <script>
    const steps = document.querySelectorAll('.step');
    const progressItems = document.querySelectorAll('.progressbar li');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const addFriendBtn = document.getElementById('addFriendBtn');
    //const form = document.getElementById('friendForm');

    let currentStep = 0;
    let friendIndex = 4;

    const photoArea = document.getElementById('photoDragArea');
    const photoInput = document.getElementById('photo');
    const photoPreview = document.getElementById('photoPreview');

    let captchaNum1, captchaNum2;

    showStep(currentStep);
    generateCaptcha();

    function showStep(n) {
      steps.forEach((step, i) => step.classList.toggle('active', i === n));
      progressItems.forEach((item, i) => item.classList.toggle('active', i <= n));
      prevBtn.disabled = (n === 0);
      nextBtn.textContent = (n === steps.length - 1) ? 'Submit' : 'Next';
    }

    prevBtn.onclick = () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    };

    nextBtn.onclick = () => {
      if (!validateStep(currentStep)) return;
      if (currentStep === steps.length - 1) {
        formSubmit();
      } else {
        currentStep++;
        if (currentStep === steps.length - 1) displaySummary();
        showStep(currentStep);
      }
    };

    function validateStep(n) {
      const inputs = steps[n].querySelectorAll('input, select, textarea');
      for (let input of inputs) {
        if (input.hasAttribute('required') && input.value.trim() === '') {
          alert(`Please fill the field "${input.previousElementSibling.textContent}".`);
          input.focus();
          return false;
        }
        if (input.type === 'email' && input.value) {
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(input.value)) {
            alert('Please enter a valid email address.');
            input.focus();
            return false;
          }
        }
        if (input.type === 'tel' && input.value) {
          const phonePattern = /^\d{10}$/;
          if (!phonePattern.test(input.value)) {
            alert('Please enter a valid 10-digit mobile number.');
            input.focus();
            return false;
          }
        }
      }
      if (n === 3) {
        let filledCount = 0;
        for (let i = 1; i <= 7; i++) {
          const bfInput = form.elements['bestfriend' + i];
          if (bfInput && bfInput.value.trim() !== '' && bfInput.offsetParent !== null) {
            filledCount++;
          }
        }
        if (filledCount < 3) {
          alert('Please enter at least 3 best friend names.');
          return false;
        }
      }
      if (n === steps.length - 1) {
        const captchaInput = document.getElementById('captchaInput').value.trim();
        if (captchaInput !== (captchaNum1 + captchaNum2).toString()) {
          alert('Incorrect CAPTCHA answer. Please try again.');
          return false;
        }
      }
      return true;
    }

    addFriendBtn.onclick = () => {
      if (friendIndex <= 7) {
        const input = form.elements['bestfriend' + friendIndex];
        if (input) {
          input.classList.remove('hidden');
          friendIndex++;
          if (friendIndex > 7) addFriendBtn.style.display = 'none';
        }
      }
    };

    document.getElementById('firstmeet').addEventListener('change', () => {
      const val = document.getElementById('firstmeet').value;
      document.getElementById('schoolClassDiv').classList.toggle('hidden', val !== 'school');
      document.getElementById('gradDiv').classList.toggle('hidden', val !== 'graduation');
      document.getElementById('otherdiv').classList.toggle('hidden', val !== 'other');
    });
    document.getElementById('currentedu').addEventListener('change', () => {
      const val = document.getElementById('currentedu').value;
      document.getElementById('prepDiv').classList.toggle('hidden', val !== 'preparation');
    });

    [['hobbies', 'hobbiesCounter'], ['meetstory', 'meetstoryCounter'], ['address', 'addressCounter']].forEach(([textareaId, counterId]) => {
      const ta = document.getElementById(textareaId);
      const counter = document.getElementById(counterId);
      if (ta && counter) {
        ta.addEventListener('input', () => {
          counter.textContent = `${ta.value.length} / ${ta.maxLength}`;
        });
        counter.textContent =` ${ta.value.length} / ${ta.maxLength}`;
      }
    });

    const emojis = document.querySelectorAll('.emoji-rating span');
    const ratingInput = document.getElementById('friendshiprating');
    emojis.forEach(emoji => {
      emoji.addEventListener('click', () => {
        emojis.forEach(e => e.classList.remove('selected'));
        emoji.classList.add('selected');
        ratingInput.value = emoji.dataset.value;
      });
      emoji.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          emoji.click();
        }
      });
    });

    photoArea.addEventListener('click', () => photoInput.click());
    photoArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      photoArea.classList.add('dragover');
    });
    photoArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      photoArea.classList.remove('dragover');
    });
    photoArea.addEventListener('drop', (e) => {
      e.preventDefault();
      photoArea.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        photoInput.files = e.dataTransfer.files;
        showPhoto(e.dataTransfer.files[0]);
      }
    });
    photoInput.addEventListener('change', () => {
      if (photoInput.files.length > 0) {
        showPhoto(photoInput.files[0]);
      }
    });
    function showPhoto(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        photoPreview.src = e.target.result;
        photoPreview.style.display = 'block';
      }
      reader.readAsDataURL(file);
    }

    function generateCaptcha() {
      captchaNum1 = Math.floor(Math.random() * 10) + 1;
      captchaNum2 = Math.floor(Math.random() * 10) + 1;
      document.getElementById('captchaLabel').textContent = `What is ${captchaNum1} + ${captchaNum2}?`;
    }

   function displaySummary() {
      const formData = new FormData(form);
      const summaryLines = [];
      for (const [key, value] of formData.entries()) {
        if (value && key !== 'captcha') {
          summaryLines.push(`${key.replace(/([A-Z])/g, ' $1').replace(/^./, c => c.toUpperCase())}: ${value}`);
        }
      }
      document.getElementById('summaryContent').textContent = summaryLines.join('\n');
    }


     function formSubmit() {
  //show popup style
  let popup = document.createElement('div');
  popup.style.position = 'fixed';
  popup.style.top = '0';
  popup.style.left = '0';
  popup.style.width = '100vw';
  popup.style.height = '100vh';
  popup.style.background = 'rgba(0,0,0,0.4)';
  popup.style.display = 'flex';
  popup.style.alignItems = 'center';
  popup.style.justifyContent = 'center';
  popup.style.zIndex = '9999';

  let box = document.createElement('div');
  box.style.background = '#fff';
  box.style.padding = '32px 36px';
  box.style.borderRadius = '10px';
  box.style.boxShadow = '0 8px 30px rgba(0,0,0,0.2)';
  box.style.textAlign = 'center';
  box.style.animation = 'popup 0.4s';

  // Animation keyframes dynamic
  let style = document.createElement('style');
  style.innerHTML = `
  @keyframes popup {from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}
  `;
  document.head.appendChild(style);

  box.innerHTML = `
    <div style="font-size:32px;color:#2ecc71;margin-bottom:8px;">ðŸŽ‰</div>
    <h2 style="margin:0 0 10px 0;color:#2ecc71;">Thank You!</h2>
    <p style="margin:0 0 18px 0;">Friendship details submitted successfully!</p>
    <button style="margin-top:8px;padding:8px 30px;background:#27ae60;color:#fff;border:none;border-radius:6px;font-size:16px;cursor:pointer;" id="closeBtn">OK</button>
  `;

  popup.appendChild(box);
  document.body.appendChild(popup);

  document.getElementById('closeBtn').onclick = function () {
    popup.remove();
  };

  // form data reset logic
  form.reset();
  friendIndex = 4;
  addFriendBtn.style.display = 'inline-block';
  photoPreview.style.display = 'none';
  currentStep = 0;
  showStep(currentStep);
  generateCaptcha();
}


const form = document.getElementById('friendForm');

// submit 
form.addEventListener('submit', async function(event) {
  event.preventDefault();

  const formData = new FormData(form);

  try {
    const response = await fetch('http://localhost:3000/submit-form', {
      method: 'POST',
      // NO CONTENT-TYPE HEADER HERE!
      body: formData
    });

    const result = await response.json();

    if (result.success) {
      alert('Form submitted successfully!');
      form.reset();
    } else {
      alert('Submission failed!');
    }
  } catch (error) {
    alert('Error submitting form');
  }
});


  </script>
  <script src="index.js"></script>
</body>
</html>